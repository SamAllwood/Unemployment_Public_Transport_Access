height_shade(texture = tx) %>%
plot_3d(heightmap = pop_matrix,
zscale = 50,
solid = F,
shadowdepth = 0.8)
# Adjusting Camera Angle
render_camera(theta = 0,
phi = 55,
zoom = 0.45,
fov = 100
)
outfile <- glue::glue("Images/Population_GMCA.jpeg")
{
start_time <- Sys.time()
cat(crayon::cyan(start_time), "\n")
if(!file.exists(outfile)) {
png::writePNG(matrix(1), target = outfile)
}
render_highquality(
filename = outfile,
interactive = TRUE,
lightdirection = 55, #Degree
lightaltitude = c(30, 80),
lightcolor = c("white", "white"),  # Set both lights to white
lightintensity = c(600, 100),
# width = 1980,
# height = 1180
samples = 1000
)
end_time <- Sys.time()
diff <- end_time - start_time
cat(crayon::cyan(diff), "\n")
}
## Script for Public Transport Job Accessibility distribution across GMCA
# 1. Setup ----------------------------------------------------------------
library(tidyverse)
library(knitr)
library(tidytransit)
library(mapview)
library(ggmap)
library(sf)
library(ggplot2)
library(ggspatial)
library(classInt)
setwd("~/Library/CloudStorage/GoogleDrive-sam.allwood3@gmail.com/My Drive/Consulting/Unemployment_Public_Transport_Access/Greater_Manchester_Combined_Authority")
# 2. Load Data ------------------------------------------------------------
# Load Manchester Geo data from file
MANCH_dataset_PTJA <- read_sf("../../Data/MANCH_dataset.shp") %>%
rename("LSOA_Code" = "LSOA21C",
"LSOA_Name" = "LSOA21N",
"TravelTime_Jobcentre" = "Tr__J_C",
"PT_Job_Access_Index" = "PT_Jb_A_I",
"PT_Job_Access_Index_bus" = "PT_J_A_I_B",
"PT_Job_Access_Index_tram" = "PT_J_A_I_T",
"PT_Job_Access_Index_walk" = "PT_J_A_I_W",
"Employed_Population" = "Employd",
"LSOA_Area" = "LSOA__2",
"Traveltime_empcent" = "Tr__E_C",
"PT_Job_Access_Index_Demand" = "PT_Jb_A_I_") %>%
st_transform(4326) %>%
mutate(PT_Job_Access_Index_bus = PT_Job_Access_Index_bus - PT_Job_Access_Index_walk,
PT_Job_Access_Index_tram = PT_Job_Access_Index_tram - PT_Job_Access_Index_walk)
# Load Metrolink Shapefile
Metrolink <- st_read("../../Data/Metrolink_Lines_Functional.shp")
Metrolink$LineName <- "Metrolink"
# GMCA Boundary + buffer
Boundaries <- read_sf("../../Data/CAUTH_DEC_2023_EN_BFC.shp")
GMCA_boundary <- Boundaries %>% filter(CAUTH23NM == "Greater Manchester") %>%
st_transform(4326)
GMCA_bound_small_buffer <- GMCA_boundary %>% st_buffer(dist=25)
# Town centres
towns_centres <- read_sf("../Data/towns_centres.shp")
## Script for Public Transport Job Accessibility distribution across GMCA
# 1. Setup ----------------------------------------------------------------
library(tidyverse)
library(knitr)
library(tidytransit)
library(mapview)
library(ggmap)
library(sf)
library(ggplot2)
library(ggspatial)
library(classInt)
setwd("~/Library/CloudStorage/GoogleDrive-sam.allwood3@gmail.com/My Drive/Consulting/Unemployment_Public_Transport_Access/Greater_Manchester_Combined_Authority")
# 2. Load Data ------------------------------------------------------------
# Load Manchester Geo data from file
MANCH_dataset_PTJA <- read_sf("../../Data/MANCH_dataset.shp") %>%
rename("LSOA_Code" = "LSOA21C",
"LSOA_Name" = "LSOA21N",
"TravelTime_Jobcentre" = "Tr__J_C",
"PT_Job_Access_Index" = "PT_Jb_A_I",
"PT_Job_Access_Index_bus" = "PT_J_A_I_B",
"PT_Job_Access_Index_tram" = "PT_J_A_I_T",
"PT_Job_Access_Index_walk" = "PT_J_A_I_W",
"Employed_Population" = "Employd",
"LSOA_Area" = "LSOA__2",
"Traveltime_empcent" = "Tr__E_C",
"PT_Job_Access_Index_Demand" = "PT_Jb_A_I_") %>%
st_transform(4326) %>%
mutate(PT_Job_Access_Index_bus = PT_Job_Access_Index_bus - PT_Job_Access_Index_walk,
PT_Job_Access_Index_tram = PT_Job_Access_Index_tram - PT_Job_Access_Index_walk)
# Load Metrolink Shapefile
Metrolink <- st_read("../../Data/Metrolink_Lines_Functional.shp")
Metrolink$LineName <- "Metrolink"
# GMCA Boundary + buffer
Boundaries <- read_sf("../../Data/CAUTH_DEC_2023_EN_BFC.shp")
GMCA_boundary <- Boundaries %>% filter(CAUTH23NM == "Greater Manchester") %>%
st_transform(4326)
GMCA_bound_small_buffer <- GMCA_boundary %>% st_buffer(dist=25)
# Town centres
towns_centres <- read_sf("../../Data/towns_centres.shp")
towns_centres_GMCA <- towns_centres %>% filter(as.vector(st_within(., GMCA_bound_small_buffer, sparse = FALSE))) %>%
st_transform(4326)
# # Plot PTJA index in GMCA ---------------------------------------------
MANCH_dataset_PTJA %>%
ggplot() +
geom_sf(data=GMCA_boundary, colour="red",linewidth=1.5)+
geom_sf(aes(fill = PT_Job_Access_Index), col = NA) +
scale_fill_gradient(low="BLACK", high="WHITE") +
labs(fill = "PTJA Index")+
geom_sf(data=Metrolink, colour="red",linewidth=0.5)+
theme_void()
# Plot PTJA index in GMCA by quantile
# Calculate PTJA quantile breaks
breaks_PTJA <- classIntervals(MANCH_dataset_PTJA$PT_Job_Access_Index, n = 5, style = "quantile")$brks
breaks_PTJA[1] <- 00
# Create a factor variable for PTJA coloring
MANCH_dataset_PTJA$color_PTJA <- cut(MANCH_dataset_PTJA$PT_Job_Access_Index, breaks = breaks_PTJA, include.lowest = TRUE, labels = FALSE)
MANCH_dataset_PTJA$color_PTJA <- as.factor(MANCH_dataset_PTJA$color_PTJA)
MANCH_dataset_PTJA$color_PTJA_bus <- cut(MANCH_dataset_PTJA$PT_Job_Access_Index_bus, breaks = breaks_PTJA, include.lowest = TRUE, labels = FALSE)
MANCH_dataset_PTJA$color_PTJA_bus <- as.factor(MANCH_dataset_PTJA$color_PTJA_bus)
MANCH_dataset_PTJA$color_PTJA_tram <- cut(MANCH_dataset_PTJA$PT_Job_Access_Index_tram, breaks = breaks_PTJA, include.lowest = TRUE, labels = FALSE)
MANCH_dataset_PTJA$color_PTJA_tram <- as.factor(MANCH_dataset_PTJA$color_PTJA_tram)
labels_PTJA <- c("Lowest PTJA Quintile","","","","Highest PTJA Quintile")
# metrolink line colouring to include in legend
line_colours <- setNames(rep("black", length(unique(Metrolink$LineName))), unique(Metrolink$LineName))
# Plot PTJA by quintile in GMCA
(PTJA <- MANCH_dataset_PTJA %>%
dplyr::select(color_PTJA, geometry) %>%
ggplot() +
geom_sf(data=GMCA_boundary, colour="black",linewidth=1.0) +
geom_sf(data = MANCH_dataset_PTJA, aes(fill = color_PTJA), color = NA) + # color = NA removes the LSOA boundaries
scale_fill_brewer(palette = "Spectral",
direction = -1,
labels = labels_PTJA) +
labs(fill = "Public Transport
Job Accessibility
(quintiles)",
color = "Metrolink")+
geom_sf(data = Metrolink,
aes(color = LineName),
#    colour="black",
linewidth = 0.8) +
geom_sf(data=towns_centres_GMCA, shape = 21, fill = 'white', size = 1.5) +
geom_label( x=-2.19, y=53.46, label="Manchester", size=3) +
geom_label( x=-2.321, y=53.50, label="Salford", size=3) +
geom_label( x=-2.092, y=53.415, label="Stockport", size=3) +
geom_label( x=-2.04, y=53.54, label="Oldham", size=3) +
geom_label( x=-2.10, y=53.63, label="Rochdale", size=3) +
geom_label( x=-2.25, y=53.585, label="Bury", size=3) +
geom_label( x=-2.483, y=53.58, label="Bolton", size=3) +
geom_label( x=-2.58, y=53.54, label="Wigan", size=3) +
scale_color_manual(values = line_colours)+
annotation_north_arrow()+
annotation_scale(location = "bl",
pad_x = unit(2.5, "cm"),
pad_y = unit(0, "cm"))+
theme_void())
ggsave(file = "Images/PTJA_GMCA.jpeg", device = "jpeg", plot = PTJA)
# bus contribution map
(PTJA_bus <- MANCH_dataset_PTJA %>%
select(color_PTJA_bus, geometry) %>%
ggplot() +
geom_sf(data=GMCA_boundary, colour="black",linewidth=1.0) +
geom_sf(data = MANCH_dataset_PTJA, aes(fill = color_PTJA_bus), color = NA) + # color = NA removes the LSOA boundaries
scale_fill_brewer(palette = "Spectral",
direction = -1,
labels = c("Lowest","","","","Highest")) +
labs(fill = "Public Transport Job
Accessibility: Bus",
color = "Metrolink")+
geom_sf(data = Metrolink,
aes(color = LineName),
colour="black",
linewidth = 0.8) +
theme_void())
# bus contribution map
(PTJA_bus <- MANCH_dataset_PTJA %>%
dplyr::select(color_PTJA_bus, geometry) %>%
ggplot() +
geom_sf(data=GMCA_boundary, colour="black",linewidth=1.0) +
geom_sf(data = MANCH_dataset_PTJA, aes(fill = color_PTJA_bus), color = NA) + # color = NA removes the LSOA boundaries
scale_fill_brewer(palette = "Spectral",
direction = -1,
labels = c("Lowest","","","","Highest")) +
labs(fill = "Public Transport Job
Accessibility: Bus",
color = "Metrolink")+
geom_sf(data = Metrolink,
aes(color = LineName),
colour="black",
linewidth = 0.8) +
theme_void())
(PTJA_tram <- MANCH_dataset_PTJA %>%
dplyr::select(color_PTJA_tram, geometry) %>%
ggplot() +
geom_sf(data=GMCA_boundary, colour="black",linewidth=1.0) +
geom_sf(data = MANCH_dataset_PTJA, aes(fill = color_PTJA_tram), color = NA) + # color = NA removes the LSOA boundaries
scale_fill_brewer(palette = "Spectral",
direction = -1,
labels = c("Lowest","","","","Highest")) +
labs(fill = "Public Transport Job
Accessibility: Tram",
color = "Metrolink")+
geom_sf(data = Metrolink,
aes(color = LineName),
colour="black",
linewidth = 0.8) +
theme_void())
mapview(MANCH_dataset_PTJA$color_PTJA_tram)
mapview(MANCH_dataset_PTJA$color_PTJA_tram)
breaks_PTJA_D <- classIntervals(MANCH_dataset_PTJA$PT_Job_Access_Index_Demand,
n = 5, style = "quantile")$brks
breaks_PTJA_D[1] <- 00
# Create a factor variable for PTJA-D coloring
MANCH_dataset_PTJA$color_PTJA_D <- cut(MANCH_dataset_PTJA$PT_Job_Access_Index_Demand,
breaks = breaks_PTJA_D,
include.lowest = TRUE,
labels = FALSE) %>%
as.factor()
labels_PTJA_D <- c("Lowest PTJA-D Quintile","","","","Highest PTJA-D Quintile")
# Plot PTJA by quintile in GMCA
(PTJA_D <- MANCH_dataset_PTJA %>%
dplyr::select(color_PTJA_D, geometry) %>%
ggplot() +
geom_sf(data=GMCA_boundary, colour="black",linewidth=1.0) +
geom_sf(data = MANCH_dataset_PTJA, aes(fill = color_PTJA_D), color = NA) + # color = NA removes the LSOA boundaries
scale_fill_brewer(palette = "Spectral",
direction = -1,
labels = labels_PTJA_D) +
labs(fill = "Public Transport
Job Accessibility
(Demand-adjusted)
(quintiles)",
color = "Metrolink")+
geom_sf(data = Metrolink,
aes(color = LineName),
#    colour="black",
linewidth = 0.8) +
geom_sf(data=towns_centres_GMCA, shape = 21, fill = 'white', size = 1.5) +
geom_label( x=-2.19, y=53.46, label="Manchester", size=3) +
geom_label( x=-2.321, y=53.50, label="Salford", size=3) +
geom_label( x=-2.092, y=53.415, label="Stockport", size=3) +
geom_label( x=-2.04, y=53.54, label="Oldham", size=3) +
geom_label( x=-2.10, y=53.63, label="Rochdale", size=3) +
geom_label( x=-2.25, y=53.585, label="Bury", size=3) +
geom_label( x=-2.483, y=53.58, label="Bolton", size=3) +
geom_label( x=-2.58, y=53.54, label="Wigan", size=3) +
scale_color_manual(values = line_colours)+
annotation_north_arrow()+
annotation_scale(location = "bl",
pad_x = unit(2.5, "cm"),
pad_y = unit(0, "cm"))+
theme_void())
ggsave(file = "Images/PTJA_D_GMCA.jpeg", device = "jpeg", plot = PTJA_D)
library(tidyverse)
library(knitr)
library(tidytransit)
library(mapview)
library(ggmap)
library(sf)
library(ggplot2)
setwd("~/Library/CloudStorage/GoogleDrive-sam.allwood3@gmail.com/My Drive/Consulting/Unemployment_Public_Transport_Access/Greater_Manchester_Combined_Authority")
# 2. Load Data ------------------------------------------------------------
MANCH_dataset_full_sf <- read_sf("../../Data/MANCH_dataset_full_sf.shp") %>%
rename("LSOA_Code" = LSOA_Cd,
"LSOA_Name" = LSOA_Nm,
"LSOA_Area" = LSOA_Ar,
"PT_Job_Access_Index" = PT_Jb_A_I,
"Job_Locations" = Emply_P,
"Traveltime_empcent" = Trvltm_,
"Townsuburb" = twnsbrb,
"Economically_active_residents" = Ecnmcl_,
"Unemployed_pop" = Unmplyd,
"Unemployment_rate" = Unmply_,
"No_car_rate" = N_cr_rt,
"White_percent" = "% White",
"Single_parent_households" = Sng_P_H,
"Single_parent_household_rate" = "%",
"Urban_rural" = Urbn_Rr,
"Pop_16" = Tt___16,
"Low_qual" = Lw_Qlfd,
"Total_residents" = Ttl_rsd
)
# Read population density shapefile from "Population_Density_Map.R" script
MAN_pop <- read_sf("../../Data/MANCH_population.shp") %>%
st_transform(4326) %>%
rename("Pop_Dens_change" = "Pp_dns_",
"LSOA21CD" = "LSOA21C",
"Man_Pop_Dens"  = "P_2021_",
"Man_Pop" = "U_P_202") %>%
dplyr::select(LSOA21CD, Pop_Dens_change, Man_Pop_Dens, Man_Pop) %>%
as.data.frame()
# Load Metrolink Shapefile
Metrolink <- st_read("../../Data/Metrolink_Lines_Functional.shp")
Metrolink$LineName <- "Metrolink"
# GMCA Boundary + buffer
Boundaries <- read_sf("../../Data/CAUTH_DEC_2023_EN_BFC.shp")
GMCA_boundary <- Boundaries %>% filter(CAUTH23NM == "Greater Manchester") %>%
st_transform(4326)
GMCA_bound_small_buffer <- GMCA_boundary %>% st_buffer(dist=25)
towns_centres <- read_sf("../../Data/towns_centres.shp")
towns_centres_GMCA <- towns_centres %>% filter(as.vector(st_within(., GMCA_bound_small_buffer, sparse = FALSE))) %>%
st_transform(4326)
# Calculate UBDC estimates ------------------------------------------------
# Note these are only used to calculate percentages of people within 45mins of closest town centre.
# Calculate UBDC estimates of time to employment centres
UBDC_access_cities <- read_csv("../../Data/access_cities_pt.csv") %>%
mutate(nearest_main_bua = as.numeric(nearest_main_bua),
nearest_sub_bua = as.numeric(nearest_sub_bua))
# Load population data
UK_pop <- read_csv("../../Data/Census2021_UsualPopulation.csv", skip=6, col_names = TRUE) %>%
drop_na() %>%
rename("Pop_2021" = "2021",
"LSOA21CD" = "2021 super output area - lower layer") %>%
mutate(LSOA21CD = sapply(strsplit(as.character(LSOA21CD), " : "), "[", 1))
# Join population to UBDC accessibility table
UBDC_pop <- left_join(UBDC_access_cities, UK_pop, by=c("geo_code"  = "LSOA21CD")) %>%
mutate(Pop_2021 = as.numeric(Pop_2021)) %>%
dplyr::select(geo_code, nearest_main_bua, nearest_sub_bua, Pop_2021) %>%
as.data.frame() %>%
drop_na()
# Calculate proportion of population within 45 minutes of employment centre from UBDC tables (whole of UK)
UBDC_count <- UBDC_pop %>% filter(nearest_main_bua <= 45) %>% summarize(Total_Pop = sum(Pop_2021))
Total_pop <- sum(UBDC_pop$Pop_2021)
UBDC_Percent_45 <- UBDC_count/Total_pop
UBDC_Percent_45
# Join population data to travel time - calculate proportion of population within 45 or 30 minutes of employment centre
MANCH_traveltime_pop <- left_join(MAN_pop,
MANCH_dataset_full_sf %>%
dplyr::select(LSOA_Code, Traveltime_empcent),
by=c("LSOA21CD"  ="LSOA_Code")) %>%
mutate(Traveltime_empcent = as.numeric(Traveltime_empcent),
Man_Pop = as.numeric(Man_Pop))
# Population within 30 and 45 mins
total_pop <- sum(MANCH_traveltime_pop$Man_Pop)
pop_within_45 <- MANCH_traveltime_pop %>% filter(Traveltime_empcent <= 45) %>% summarize(Total_Pop_45 = sum(Man_Pop))
pc_within_45 <- pop_within_45/total_pop
pop_within_30 <- MANCH_traveltime_pop %>% filter(Traveltime_empcent <= 30) %>% summarize(Total_Pop_30 = sum(Man_Pop))
pc_within_30 <- pop_within_30/total_pop
# Plot Employment Centre Travel Time Map ----------------------------------
# Plot travel time to nearest employment Centre
(emp_cent_map <-
MANCH_dataset_full_sf %>%
select(Traveltime_empcent, geometry) %>%
ggplot() +
geom_sf(data=GMCA_boundary, colour="black", linewidth=1.5)+
geom_sf(aes(fill = Traveltime_empcent), col = NA) +
scale_fill_viridis_b(breaks = seq(0, 60, 15), direction = -1) +
labs(fill = "Travel time to
nearest employment
centre (mins)",
color = "Metrolink") +
geom_label( x=-2.19, y=53.46, label="Manchester", size=3) +
geom_label( x=-2.321, y=53.50, label="Salford", size=3) +
geom_label( x=-2.092, y=53.415, label="Stockport", size=3) +
geom_label( x=-2.04, y=53.54, label="Oldham", size=3) +
geom_label( x=-2.10, y=53.63, label="Rochdale", size=3) +
geom_label( x=-2.25, y=53.585, label="Bury", size=3) +
geom_label( x=-2.483, y=53.58, label="Bolton", size=3) +
geom_label( x=-2.58, y=53.54, label="Wigan", size=3) +
geom_sf(data = Metrolink, aes(color = LineName), linewidth = 1.0) +
geom_sf(data=towns_centres_GMCA, shape = 21, fill = 'white', size = 1.5) +
annotation_north_arrow()+
annotation_scale(location = "bl",
pad_x = unit(2.5, "cm"),
pad_y = unit(0, "cm"))+
theme_void() )
# Plot Employment Centre Travel Time Map ----------------------------------
# Plot travel time to nearest employment Centre
(emp_cent_map <-
MANCH_dataset_full_sf %>%
dplyr::select(Traveltime_empcent, geometry) %>%
ggplot() +
geom_sf(data=GMCA_boundary, colour="black", linewidth=1.5)+
geom_sf(aes(fill = Traveltime_empcent), col = NA) +
scale_fill_viridis_b(breaks = seq(0, 60, 15), direction = -1) +
labs(fill = "Travel time to
nearest employment
centre (mins)",
color = "Metrolink") +
geom_label( x=-2.19, y=53.46, label="Manchester", size=3) +
geom_label( x=-2.321, y=53.50, label="Salford", size=3) +
geom_label( x=-2.092, y=53.415, label="Stockport", size=3) +
geom_label( x=-2.04, y=53.54, label="Oldham", size=3) +
geom_label( x=-2.10, y=53.63, label="Rochdale", size=3) +
geom_label( x=-2.25, y=53.585, label="Bury", size=3) +
geom_label( x=-2.483, y=53.58, label="Bolton", size=3) +
geom_label( x=-2.58, y=53.54, label="Wigan", size=3) +
geom_sf(data = Metrolink, aes(color = LineName), linewidth = 1.0) +
geom_sf(data=towns_centres_GMCA, shape = 21, fill = 'white', size = 1.5) +
annotation_north_arrow()+
annotation_scale(location = "bl",
pad_x = unit(2.5, "cm"),
pad_y = unit(0, "cm"))+
theme_void() )
ggsave(file = "Images/Unemp_rate_Man_city.jpeg", device = "jpeg", plot = Unemp_rate_Manch_city)
(Unemp_rate_Manch_city <- MANCH_city_unemp %>%
select (color, Unemployment_rate) %>%
ggplot() +
#  geom_sf(data=GMCA_boundary, colour="black",linewidth=1.0) +
#  geom_sf(data=LADs_MANCH, fill=NA, color = "black", size = 1) +
geom_sf(aes(fill = color), color = NA) + # 'color = NA' removes the LSOA boundaries
scale_fill_brewer(palette = "Spectral",
direction = -1,
labels = labels_Man_unemp) +
labs(fill = "Unemployment
rate (quintiles)") +
geom_sf(data=MAN_city_boundary, fill = NA, col = "black", linewidth = 0.2) +
annotation_north_arrow()+
annotation_scale(location = "tr")+
theme_void())
(Unemp_rate_Manch_city <- MANCH_city_unemp %>%
dplyr::select (color, Unemployment_rate) %>%
ggplot() +
#  geom_sf(data=GMCA_boundary, colour="black",linewidth=1.0) +
#  geom_sf(data=LADs_MANCH, fill=NA, color = "black", size = 1) +
geom_sf(aes(fill = color), color = NA) + # 'color = NA' removes the LSOA boundaries
scale_fill_brewer(palette = "Spectral",
direction = -1,
labels = labels_Man_unemp) +
labs(fill = "Unemployment
rate (quintiles)") +
geom_sf(data=MAN_city_boundary, fill = NA, col = "black", linewidth = 0.2) +
annotation_north_arrow()+
annotation_scale(location = "tr")+
theme_void())
(Unemp_rate_Manch_city <- MANCH_city_unemp %>%
dplyr::select (color, Unemployment_rate) %>%
ggplot() +
#  geom_sf(data=GMCA_boundary, colour="black",linewidth=1.0) +
#  geom_sf(data=LADs_MANCH, fill=NA, color = "black", size = 1) +
geom_sf(aes(fill = color), color = NA) + # 'color = NA' removes the LSOA boundaries
scale_fill_brewer(palette = "Spectral",
direction = -1,
labels = labels_Man_unemp) +
labs(fill = "Unemployment
rate (quintiles)") +
geom_sf(data=MAN_city_boundary, fill = NA, col = "black", linewidth = 0.2) +
annotation_north_arrow()+
annotation_scale(location = "tr")+
theme_void())
# Manchester City Centre unemployment
MANCH_city_unemp <- MANCH_dataset_Unemp %>% filter(TCITY15=="Manchester")
# Local Authority District (LAD) map
(LADs <- MANCH_dataset_Unemp %>%
ggplot() +
geom_sf(data=LADs_MANCH, aes(fill = LAD21NM), color = "black", size = 1) +
scale_fill_brewer(palette = "Set1", name = "LAD Boundaries") + # Customize legend for LAD boundaries
theme_void() )
library(tidyverse)
library(knitr)
library(tidytransit)
library(mapview)
library(ggmap)
library(sf)
library(ggplot2)
library(classInt)
library(RColorBrewer)
library(terra)
library(ggspatial)
setwd("~/Library/CloudStorage/GoogleDrive-sam.allwood3@gmail.com/My Drive/Consulting/Unemployment_Public_Transport_Access/Greater_Manchester_Combined_Authority")
# 2. Load Data ------------------------------------------------------------
# Load Manchester Geo data from file
MANCH_dataset_Unemp <- read_sf("../../Data/MANCH_dataset_full_sf.shp") %>%
rename("LSOA_Code" = LSOA_Cd,
"LSOA_Name" = LSOA_Nm,
"LSOA_Area" = LSOA_Ar,
"PT_Job_Access_Index" = PT_Jb_A_I,
"Job_Locations" = Emply_P,
"Traveltime_empcent" = Trvltm_,
"Townsuburb" = twnsbrb,
"Economically_active_residents" = Ecnmcl_,
"Unemployed_pop" = Unmplyd,
"Unemployment_rate" = Unmply_,
"No_car_rate" = N_cr_rt,
"White_percent" = "% White",
"Single_parent_households" = Sng_P_H,
"Single_parent_household_rate" = "%",
"Urban_rural" = Urbn_Rr,
"Pop_16" = Tt___16,
"Low_qual" = Lw_Qlfd,
"Total_residents" = Ttl_rsd
) %>%
st_transform(4326)
sum(MANCH_dataset_Unemp$Economically_active_residents)
# GMCA Boundary + buffer
Boundaries <- read_sf("../../Data/CAUTH_DEC_2023_EN_BFC.shp")
GMCA_boundary <- Boundaries %>% filter(CAUTH23NM == "Greater Manchester") %>%
st_transform(4326)
GMCA_bound_small_buffer <- GMCA_boundary %>% st_buffer(dist=200)
# Create a 20km buffer around the GMCA boundary line
buffered_GMCA_boundary <- st_buffer(GMCA_boundary, dist = 20000) %>%
st_transform(4326)
# Read Towns and City boundaries
towns <- st_read("../../Data/TCITY_2015_EW_BGG_V2.shp") %>%
st_transform(4326)
towns$geometry <- st_make_valid(towns$geometry)
towns_within_GMCA <- towns[st_within(towns, GMCA_bound_small_buffer, sparse = FALSE), ]
# Read Local Authority District (LAD) boundaries
LADs <- read_sf("../../Data/LAD_DEC_2021_GB_BFC.shp") %>%
st_transform(4326)
